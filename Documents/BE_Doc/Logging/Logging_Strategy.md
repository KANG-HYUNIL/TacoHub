
# TacoHub 로깅 전략 및 구조

## 1. 도입 동기 및 분리 원칙

TacoHub는 비즈니스 감사와 시스템 운영 목적을 분리하여, **AOP 감사 로깅**과 **시스템 로깅(SLF4J/Logback)**을 독립적으로 운영합니다. 각 로깅 경로는 목적, 저장소, 운영 전략이 다르며, 환경별로 logback 및 Parameter Store를 통해 동적으로 관리됩니다.


## 2. 로깅 시스템 아키텍처

### 2.1 이중 로깅 구조의 설계 이유

**분리된 관심사 (Separation of Concerns)**
- **AOP 감사 로깅**: 비즈니스 도메인 로직의 추적과 감사, 구조화된 데이터, 장기 보관, 법적 규정 준수
- **시스템 로깅**: 시스템 운영과 기술적 모니터링, 실시간 모니터링, 빠른 문제 진단, 운영 편의성

**각기 다른 목적과 요구사항**
- **감사 로깅**: 구조화된 JSON, 사용자/파라미터/액션/성능/에러 정보 포함, S3 장기 보관, CloudWatch 실시간 모니터링, 법적 규정 준수
- **시스템 로깅**: 텍스트 기반, 시스템 상태/에러/운영 정보, CloudWatch 실시간 모니터링, 파일 백업, 운영 환경별 필터링

### 2.2 로그 경로 분리 구조 (아키텍처 다이어그램)

```
┌─────────────────────────────────────────────────────────────┐
│                    TacoHub 애플리케이션                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────┐           ┌──────────────────────┐     │
│  │   비즈니스 로직   │           │   시스템/오류 로그     │     │
│  │                 │           │                      │     │
│  │ @AuditLogging   │           │ log.error()          │     │
│  │ 어노테이션       │           │ log.warn()           │     │
│  │                 │           │ log.info()           │     │
│  └─────────────────┘           └──────────────────────┘     │
│          │                              │                  │
│          ▼                              ▼                  │
│  ┌─────────────────┐           ┌──────────────────────┐     │
│  │ AuditLoggingAspect│         │     SLF4J/Logback    │     │
│  │                 │           │                      │     │
│  │ • 구조화된 데이터 │           │ • 텍스트 기반 로그    │     │
│  │ • 사용자 추적     │           │ • 시스템 모니터링     │     │
│  │ • 파라미터 기록   │           │ • 오류 추적          │     │
│  └─────────────────┘           └──────────────────────┘     │
│          │                              │                  │
└──────────┼──────────────────────────────┼──────────────────┘
           │                              │
           ▼                              ▼
┌─────────────────┐           ┌──────────────────────┐
│ AuditLogService │           │    CloudWatch        │
│                 │           │                      │
│ • File 저장     │           │ • 실시간 모니터링     │
│ • S3 아카이빙   │           │ • 알람 설정          │
│ • 장기 보관     │           │ • 로그 검색          │
└─────────────────┘           └──────────────────────┘
```

### 2.3 저장소별 특성과 라이프사이클

#### File Storage (로컬 파일)
- **용도**: 즉시 접근 가능한 로컬 백업
- **보관 기간**: 7-30일 (디스크 용량에 따라)
- **장점**: 빠른 접근, 네트워크 독립적
- **단점**: 서버 장애 시 손실 위험

#### CloudWatch
- **용도**: 실시간 모니터링 및 알람
- **보관 기간**: 7-30일
- **장점**: 실시간 검색, 알람 연동, 대시보드
- **단점**: 상대적으로 높은 비용

#### S3 Storage
- **용도**: 장기 보관 및 규정 준수
- **보관 기간**: 7년 (자동 라이프사이클)
- **장점**: 저렴한 비용, 무제한 용량, 압축 지원
- **단점**: 검색 속도 상대적으로 느림

### 2.4 라이프사이클 관리

```
실시간 로그 → File (즉시 접근)
             ↓
           CloudWatch (7-30일, 모니터링용)
             ↓
           S3 Standard (0-90일)
             ↓
           S3 IA (90-365일)
             ↓
           S3 Glacier (365-2555일)
             ↓
           S3 Deep Archive (2555일+)
```

### 2.5 비동기 처리 및 복구 전략

- **비동기 처리**: 감사 로그는 별도 스레드풀/AsyncAppender로 저장, 메인 로직 영향 최소화
- **저장소 장애 시 대응**: 하나의 저장소 실패가 다른 저장소에 영향 없음, 일부 실패 시에도 서비스 계속 동작
- **오류 기록**: 저장소별 실패 정보 별도 로깅

---

## 3. 환경별 운영 전략

| 환경      | 감사 로깅                | 시스템 로깅                | 로그 레벨 |
|-----------|-------------------------|----------------------------|-----------|
| Local     | 파일                    | 콘솔+파일                  | DEBUG     |
| Test      | 파일+CloudWatch(오류)   | 파일+CloudWatch(WARN/ERROR)| INFO      |
| Prod      | 파일+CloudWatch+S3      | 파일+CloudWatch(모든 레벨) | INFO      |

## 4. logback/Parameter Store 기반 설정 관리

- logback-spring.xml에서 환경변수 및 Parameter Store 값으로 로그 그룹, 배치, flush 등 동적 관리
- 운영 환경 변경 시 Parameter Store 값만 변경하면 무중단 설정 변경 가능
- 실제 운영에서는 Parameter Store를 통해 로그 그룹명, 배치 설정, 인증 정보 등 주요 값을 안전하게 관리

## 5. 구현 예시

### 5.1 감사 로깅 예시
```java
@AuditLogging(action = "워크스페이스_생성", includeParameters = true)
public WorkSpaceEntity createWorkspaceEntity(String newWorkspaceName) { ... }
```

### 5.2 시스템 로깅 예시
```java
log.info("사용자 생성 시작: {}", user.getEmail());  // INFO → Prod만 CloudWatch
log.warn("중복 사용자: {}", user.getEmail());      // WARN → Test/Prod 모두 CloudWatch
log.error("시스템 오류: {}", e.getMessage());      // ERROR → Test/Prod 모두 CloudWatch
```

## 6. 운영 전략 및 주의사항

- 감사/시스템 로그 경로는 완전히 분리되어 운영됨
- 환경별 logback 설정, Parameter Store 값, IAM 권한 등 사전 준비 필수
- 장애/트러블슈팅은 실제 발생 시 별도 문서로 관리

---

이 문서는 TacoHub의 로깅 전략을 감사/시스템 로깅의 분리, 환경별 운영 구조, logback/Parameter Store 기반 설정 관리, 실제 구현 예시 중심으로 명확히 설명합니다. 불필요한 일반론, 향후계획 등은 축소하였으며, 실제 운영에 필요한 핵심 정보만을 제공합니다.


